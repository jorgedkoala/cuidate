var ec_1 = ['ec_1','3','estiramiento cervical','Partiendo de una posición neutra (cuello recto, brazos estirados y relajados al lado del cuerpo), inclinar la cabeza hacia atrás , mantener esta posición. Recuperar la posición inicial e inclinar la cabeza hacia delante, mantener esta posición. Repetir. '];
var ec_2 = ['ec_2','3','estiramiento cervical','Partiendo de una posición neutra, rotar la cabeza hacia el lado derecho, mantener la posición. Recuperar la posición inicial y rotar la cabeza hacia el lado contrario, mantener la posición . Repetir. '];
var ec_3 = ['ec_3','5','estiramiento cervical','Partiendo de un posición neutra, (inspirar) inclinar la cabeza hacia el lado derecho ( espirar), mantener la posición. Recuperar la posición inicial e inclinar hacia el lado con trario, mantener esta posición. Repetir. '];
var ec_4 = ['ec_4','3','estiramiento cervical','Partiendo de una posición inicia l con las manos en la nuca, (inspirar) llevar los codos hacia atrás hasta que queden alineados con la cabeza, mantener esta posición. Seguidamente, llevar los codos hacia delante de la cabeza hasta que casi se toquen (espirar). Repetir. '];
var ec_5 = ['ec_5','5','estiramiento cervical','Partiendo de una posición neutra, levantar los hombros hacia el techo, mantener esta posición. Seguidamente, bajar los hombros empujando los dedos hacia abajo, como si quisiéramos tocar el suelo. Repetir'];
var pc_1 = ['pc_1','3','potenciacion cervical','Partiendo de una posición inicial con las manos en la frente, apretar la cabeza contra las manos, mantener esta posición y volver a la posición inicial.'];
var pc_2 = ['pc_2','3','potenciacion cervical','Partiendo de una posición inicial con las manos en la nuca, apretar la cabeza contra las manos, mantener esta posición y vo lver a la posición inicial.'];
var pc_3 = ['pc_3','3','potenciacion cervical','Partiendo de una posición inicial con una mano apoyada por encima de la oreja, apretar la cabeza contra la mano, mantener est a posición y volver a la posición inicial. Repetir con ambos lados.'];
var pc_4 = ['pc_4','3','potenciacion cervical','Partiendo de una posición inicial con la mano abrazando la mandíbula, apretar la cabeza contra la mano como si quisiéramos realizar un giro de cuello hacia ese lado, mantener esta posición y volver a la posición inicial. Repetir con ambos lados.'];
var el_1 = ['el_1','3','estiramiento lumbar','Partiendo de una posición inicial de tumbado hacia arriba con las rodillas flexionadas, estirar la rodilla derecha a la vez que flexionamos la cadera y el tobillo, mantener esta posición y volver a la posición inicial. Repetir con cada pierna.'];
var el_2 = ['el_2','5','estiramiento lumbar','Partiendo de una posición inicial de tumbado hacia arriba con las rodillas flexionadas, retroceder la pierna izquierda flexionándola hacia el pecho a la vez que extendemos la pierna derecha intentando mantenerla pegada al suelo. Repetir con cada pierna.'];
var el_3 = ['el_3','3','estiramiento lumbar','Partiendo de una posición inicial de tumbado hacia arriba con las rodillas flexionadas, encoger las piernas flexionándolas hacia el pecho, mantener esta posición. Repetir.'];
var el_4 = ['el_4','3','estiramiento lumbar','Partiendo de una posición inicial de tumbado hacia arriba con las rodillas flexionadas, levantar la pierna derecha y apoyar el tobillo en la cara anterior del muslo izquierdo, tomar aire y, al soltarlo, llevar la rodilla izquierda hacia el pecho, mantener esta posición. Repetir con cada pierna.'];
var el_5 = ['el_5','3','estiramiento lumbar','Partiendo de la posición de cuadrupedia, tomar aire por la nariz y, al soltarlo, ir a sentarse sobre los talones, dejando los brazos estirados hacia delante, mantener esta posición. Repetir .'];
var el_6 = ['el_6','5','estiramiento lumbar','Partiendo de la posición de cuadrupedia, tomar aire y, al soltarlo, flexionar el cuello arqueando la columna hacia arriba, contrayendo la musculatura abdominal de forma que el ombligo se dirija hacia dentro y arriba, mantener esta posición. Repetir.'];
var pl_1 = ['pl_1','3','potenciacion lumbar','Partiendo de la posición inicial de cuadrupedia y con el cuello recto mirando hacia el suelo, elevar y estirar un brazo, con el codo en extensión y paralelo al suelo , mantener esta posición. Repetir con cada brazo.'];
var pl_2 = ['pl_2','3','potenciacion lumbar','Partiendo de la posición inicial de cuadrupedia, elevar una pierna (extendiendo el pie hacia fuera) y el brazo del lado con trario, mantener esta posición. Repetir con cada pierna. '];
var pl_3 = ['pl_3','5','potenciacion lumbar','Partiendo de la posición inicial de tumbado con las piernas flexionadas, elevar la pelvis hacia el techo hasta poner recta la espalda, apoyando lo talones y manos, contraer los glúteos y mantener esta posición. Repetir. '];
var pl_4 = ['pl_4','3','potenciacion lumbar','Partiendo de la posición inicial de tumbado con las piernas flexionadas y con las manos en la nuca, elevar la cabeza hasta que se despeguen los omóplatos del suelo, mantener la posición y descender lentamente soltando el aire muy despacio, siendo la nuca la última en tocar el suelo. Repetir.'];
var pl_5 = ['pl_5','5','potenciacion lumbar','Partiendo de la posición inicial de tumbado con las piernas flexionadas, elevar las piernas hasta la posición vertical con lo pies paralelos al techo, luego exten der las rodillas por e cima de los 60º, nunca por debajo, mantener esta posición. Doblar las rodillas muy lentamente y recuperar la posición inicial. Repetir. '];
var pl_6 = ['pl_6','3','potenciacion lumbar','Partiendo de la posición inicial de tumbado con las piernas flexionadas, llevar la mano derecha sobre la cara anterior de la rodilla izquierda e intentar dirigir la rodilla hacia el pecho a la vez que impedimos el movimiento con la mano, mantener esta posición. Repetir con cada pierna. '];
var pl_7 = ['pl_7','3','potenciacion lumbar','Partiendo de la posición inicial de tumbado con las piernas flexionadas, inspirar al mismo tiempo que levantamos el abdomen aumentando la curvatura lumbar. Descender la columna lumbar, soltando el aire por la boca, hasta que contacte con el suelo. Repetir.'];

var ec = [ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4];

var el = [el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7];
//var listaejer = [ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4,el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7];
var repeticionespendientes;



document.addEventListener("deviceready", onDeviceReady, false);

function onDeviceReady(){
   // alert ('aqui');
        //window.plugin.notification.local.add({ message: 'Great app!' });
    
    initAd();
    
    // display a banner at startup
    window.plugins.AdMob.createBannerView();
    //showAd(true, function(){alert('success ad');},function(e){alert(JSON.stringify(e));});
    // prepare the interstitial
//    window.plugins.AdMob.createInterstitialView();
    
    // somewhere else, show the interstital, not needed if set autoShow = true
//    window.plugins.AdMob.showInterstitialAd();
    
    
    
    console.log (':::::::::::::::::::::::::::::::::::::::::::::::::::::::::INIT::::::::::::::::::::::::::::::::::::::::');
    sessionStorage["ejercicio"] = 0;
    set_storage();
    set_ec();
    ejercicio1();
}

$(document).bind('pageinit', function(event) {
                 activePage = $(event.target);
                 console.log('activePage: ' + activePage);
                 
                 console.log('ACTIVEPAGENAME: ' + getActivePageName());
                 
                 switch (getActivePageName()){
                 case 'home':
				 $.i18n.init({ lng: localStorage["lang"], debug: true }, function(t) {
                             // save to use translation function as resources are fetched
                             //  $(".menu").i18n();
                             $("body").i18n();
                             });
                 
                 inicio();
                 //timer();
                 // $('#reloj').countdown({until: +50});
                 //$('#reloj').html('hfhjfhjil');
                 
                 console.log('Cargando inicio');
                 //loadCalendar2();
                 break;
                 
                 case 'config':
                 //console.log ('listando notificaciones');
                 //notificacion();
                 init_config ();
                 break;
                 
                 
                 case 'ejercicios':
                 //creafecha();
                 
                 cargapresentacion();
                 break;

                 }
});




function getActivePageName(){
    var sRet = 'pageMain';
    if (activePage!=null) {
        sRet = activePage.attr("id");    
    }    
    return sRet;
}

function countdowwnoff(){
    navigator.notification.beep(1);
    siguiente_ejercicio();
    }
    //navigator.notification.beep(2);
function ejercicio1(){
    //N_img = $( '#gym img' ).attr('src').substring(20,21);
    //   alert('ejercicio1');
            sessionStorage["ejercicio"] =0;
    display_img = './img/ejercicios/' + listaejer[sessionStorage["ejercicio"]][0] + '.png';
    //alert (display_img);
    $( '#gym img' ).attr('src', display_img );
    $( '#titulo_e' ).html(listaejer[sessionStorage["ejercicio"]][2]);
    $( '#repeticiones' ).html(listaejer[sessionStorage["ejercicio"]][1] + ' repeticiones');
    $('#desc_ejercicio').html(listaejer[sessionStorage["ejercicio"]][3]+'<br>');
    repeticionespendientes = listaejer[sessionStorage["ejercicio"]][1] ;
}


function siguiente_ejercicio(){
    //N_img = $( '#gym img' ).attr('src').substring(20,21);
    sessionStorage["ejercicio"]++;
    //alert(sessionStorage["ejercicio"]);
    if (sessionStorage["ejercicio"] > listaejer.length){
        sessionStorage["ejercicio"] =0;
    }
    display_img = './img/ejercicios/' + listaejer[sessionStorage["ejercicio"]][0] + '.png';
    //alert (display_img);
    $( '#gym img' ).attr('src', display_img );
    $( '#titulo_e' ).html(listaejer[sessionStorage["ejercicio"]][2]);
    $( '#repeticiones' ).html(listaejer[sessionStorage["ejercicio"]][1] + ' repeticiones');
    $('#desc_ejercicio').html(listaejer[sessionStorage["ejercicio"]][3]+'<br>');
    repeticionespendientes = listaejer[sessionStorage["ejercicio"]][1] ;
}

function anterior_ejercicio(){
    sessionStorage["ejercicio"]--;
    //alert(sessionStorage["ejercicio"]);
    if (sessionStorage["ejercicio"] < 0){
        sessionStorage["ejercicio"] = listaejer.length-1;
    }
    display_img = './img/ejercicios/' + listaejer[sessionStorage["ejercicio"]][0] + '.png';
    //alert (display_img);
    $( '#gym img' ).attr('src', display_img );
    $( '#titulo_e' ).html(listaejer[sessionStorage["ejercicio"]][2]);
    $( '#repeticiones' ).html(listaejer[sessionStorage["ejercicio"]][1] + ' repeticiones');
    $('#desc_ejercicio').html(listaejer[sessionStorage["ejercicio"]][3]+'<br>');
    repeticionespendientes = listaejer[sessionStorage["ejercicio"]][1] ;
}

function Avisos(){
    window.plugin.notification.local.cancelAll(function () {
                                               // All notifications have been canceled
                                               });
    var dias = '' + localStorage["dias"].replace(/\,/g, ' ') + '';
    var selecteddias = dias.split(" ");
    
    var inicio = Number($('#inicio').val().substring(0,2));
    var minutos = Number($('#inicio').val().substring(3,5));
    //alert (inicio + ' # ' + minutos);
    var fin = Number($('#fin').val().substring(0,2));
    
    var intervalo = Number($('#horas').val());
    

    $.each(selecteddias, function (i, v) {
           //alert (v);
           var fecha = Date.parse('next ' + v).add({
                                                minutes: minutos,
                                                   hours: inicio
                                                   });
           
           for (x = inicio; x < fin; x +=intervalo){
           
           var id= i.toString() + x.toString();
           var calendario1 = new Date(fecha);
           
           //alert (id + ' ### ' + calendario1);
           window.plugin.notification.local.add({
                                                id:         id,
                                                date:       calendario1,
                                                message:    'Feel Good te recuerda realizar tus ejercicios, tu salud es importante',
                                                title:      'Aviso Feel Good',
                                                repeat:  'weekly',
                                                badge:      1,
                                                autoCancel: true,
                                                foreground: 'foreground',
                                                background: 'background'
                                                });
           console.log ('notificacion log 2' + calendario1);
           fecha.add({
                     hours:intervalo
                    });
                      }
                      });
    
    alert ('Programación realizada');
     window.location.assign("#home");
}




function inicio(){
    
    $('div.ui-page').live("swipeleft", function(){
                          //var nextpage = $(this).next('div[data-role="page"]');
                          // swipe using id of next page if exists
                          siguiente_ejercicio();
                          
                          
                          
                          });
    
    $('div.ui-page').live("swiperight", function(){
                          //var nextpage = $(this).next('div[data-role="page"]');
                          // swipe using id of next page if exists
                          anterior_ejercicio();
                          });
    
    $(function(){
      // Bind the swipeHandler callback function to the swipe event on div.box
      $( "div.gym" ).on( "swipe", swipeHandler );
      function swipeHandler( event ){
      
      alert("swipe");
      }
      });
    
    

    set_storage();

    
    
}


function init_config(){
    $('#horas').attr('value',localStorage["horas"]).slider('refresh');
    
    $('#inicio').attr('value',localStorage["inicio"]);
    $('#fin').attr('value',localStorage["fin"]);
   
    
    
    //SET Select multiples dias
    var dias = '' + localStorage["dias"].replace(/\,/g, ' ') + '';
    var selected = dias.split(" ");
    $.each(selected, function (i, v) {
           $('#dias option[value="' + v + '"]').prop("selected", true);
           $('#dias').selectmenu('refresh');
           });
    //FIN SET multiples dias
    
    //SET Select multiples ejercicios
    var ejercicios = '' + localStorage["ejercicios"].replace(/\,/g, ' ') + '';
    var selected = ejercicios.split(" ");
    $.each(selected, function (i, v) {
           $('#ejercicios option[value="' + v + '"]').prop("selected", true);
           $('#ejercicios').selectmenu('refresh');
           });
    //FIN SET multiples ejercicios
    
    $('#inicio').on('change',function(){localStorage["inicio"] = $('#inicio').val();});
    $('#fin').on('change',function(){localStorage["fin"] = $('#fin').val();});
    
    $('#horas').on('change',function(){localStorage["horas"] = $('#horas').val();});

    $('#dias').change(function(){localStorage["dias"] = $('#dias').val()});
    $('#ejercicios').change(function(){
                            localStorage["ejercicios"] = $('#ejercicios').val();
                            set_ec();
                            });
    

    //***********************************************************************
    //***********************************************************************
    //***********************************************************************
//   window.plugin.notification.local.getTriggeredIds(function (triggeredIds) {
//                                                     alert('Triggered IDs: ' + triggeredIds.join(' ,'));
//                                                     });
   
//    window.plugin.notification.local.getScheduledIds(function (scheduledIds) {
//                                                     alert('Scheduled IDs: ' + scheduledIds.join(' ,'));
                                                     //ides =  scheduledIds;
                                                     //for each (var id in ides){
                                                     //alert (ides);
//                                                     alert(scheduledIds);
//                                                     id= 49;
//                                                     window.plugin.notification.local.isScheduled(id, function (isScheduled) {
                                                                                                  //console.log('Notification with ID ' + id + ' is scheduled: ' + isScheduled);
//                                                                                                  alert('Notification with ID ' + id + ' is scheduled: ' + isScheduled);
//                                                                                                  });
                                                     //}
//                                                     window.plugin.notification.local.isTriggered(id, function (isTriggered) {
//                                                                                                   alert('Notification with ID ' + id + ' is triggered: ' + isTriggered);
//                                                                                                  });
//                                                     });
   // alert (window.plugin.notification.local.getDefaults());
    //***********************************************************************
    //***********************************************************************
    //***********************************************************************
    
}

function set_storage(){
    if (localStorage.getItem("inicio") === null){
        localStorage["inicio"] = '09:00';
    }
    if (localStorage.getItem("fin") === null){
        localStorage["fin"] = '20:00';
    }

    if (localStorage.getItem("ejercicios") === null){
        localStorage["ejercicios"] = 'cervicales,lumbares';
    }
    if (localStorage.getItem("dias") === null){
        localStorage["dias"] = 'monday,tuesday,wednesday,thursday,friday';
    }
    if (localStorage.getItem("horas") === null){
        localStorage["horas"] = '2';
    }
}
function miseleccion(seleccion){
    
        listaejer = [];
    switch (seleccion){
        case 'cervicales':
            listaejer.push(ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4);
            ejercicio1();
            
            break;
        case 'lumbares':
            listaejer.push(el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7);
            ejercicio1();
            
            break;
        case 'todos':
            listaejer = [ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4,el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7];
            ejercicio1();
            
            break;
    }
    window.location.assign("#home");
}
function set_ec(){
    var ejercicios = '' + localStorage["ejercicios"].replace(/\,/g, ' ') + '';
    var selected = ejercicios.split(" ");
    if (localStorage.getItem("ejercicios") === null || selected.length == 0){
        listaejer = [ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4,el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7];
        //alert('nada');
    
    }
    else
    {
    listaejer = [];
     //alert('vaciar');
 
    }

    
    //if (selected.length = 2){
     //   listaejer = [ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4,el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7];
    //}
    //else
    //{
       // alert ('else');
    $.each(selected, function (i, v) {
          
           if (v == 'cervicales'){
          listaejer.push(ec_1,ec_2,ec_3,ec_4,ec_5,pc_1,pc_2,pc_3,pc_4);
           //alert ('llenar1 ' + listaejer);
           }
           if (v == 'lumbares'){
           listaejer.push(el_1,el_2,el_3,el_4,el_5,el_6,pl_1,pl_2,pl_3,pl_4,pl_5,pl_6,pl_7);
           //alert ('llenar2 ' + listaejer);
           }
           });
    //}
    //}
    //alert (listaejer);
    ejercicio1();

}




//ADS**************ADS*****************ADS********************ADS*******************
//ADS**************ADS*****************ADS********************ADS*******************
//ADS**************ADS*****************ADS********************ADS*******************

function initAd(){
    if ( window.plugins && window.plugins.AdMob ) {
        var ad_units = {
            ios : {
            //banner: 'pub-7078925255346426',
            banner: 'ca-app-pub-7078925255346426/8251530799',
            interstitial: 'ca-app-pub-7078925255346426/9728263996'
            },
            android : {
                banner: 'ca-app-pub-7078925255346426/5577265996',
            //banner: 'ca-app-pub-xxx/9375997553',
            //interstitial: 'ca-app-pub-xxx/1657046752'
             interstitial: 'ca-app-pub-7078925255346426/1007465594'
            },
            wp8 : {
            banner: 'ca-app-pub-7078925255346426/5577265996',
            //    banner: 'pub-7078925255346426',
            interstitial: 'ca-app-pub-xxx/1657046759'
            }
        };
        var admobid = "";
        if( /(android)/i.test(navigator.userAgent) ) {
            admobid = ad_units.android;
        } else if(/(iphone|ipad)/i.test(navigator.userAgent)) {
            admobid = ad_units.ios;
        } else {
            admobid = ad_units.wp8;
        }
        
        window.plugins.AdMob.setOptions( {
                                        publisherId: admobid.banner,
                                        interstitialAdId: admobid.interstitial,
                                        bannerAtTop: false, // set to true, to put banner at top
                                        overlap: false, // set to true, to allow banner overlap webview
                                        offsetTopBar: true, // set to true to avoid ios7 status bar overlap
                                        isTesting: false, // receiving test ad
                                        autoShow: true // auto show interstitial ad when loaded
                                        });
        
        //alert (admobid.banner);
        registerAdEvents();
        
    } else {
        alert( 'admob plugin not ready' );
    }
}
// optional, in case respond to events
function registerAdEvents() {
    document.addEventListener('onReceiveAd', function(){});
    document.addEventListener('onFailedToReceiveAd', function(data){});
    document.addEventListener('onPresentAd', function(){});
    document.addEventListener('onDismissAd', function(){ });
    document.addEventListener('onLeaveToAd', function(){ });
    document.addEventListener('onReceiveInterstitialAd', function(){ });
    document.addEventListener('onPresentInterstitialAd', function(){ });
    document.addEventListener('onDismissInterstitialAd', function(){ });
}


//ADS**************ADS*****************ADS********************ADS*******************
//ADS**************ADS*****************ADS********************ADS*******************
//ADS**************ADS*****************ADS********************ADS*******************